library:
  name: "hdf5"
  version: "2.0.0-2"
  repo_url: "https://github.com/HDFGroup/hdf5.git"
  language: "c"

# compiler & sanitizer 
compiler:
  CC_FUZZ: "afl-clang-fast"
  CXX_FUZZ: "afl-clang-fast++"
  CFLAGS_ASAN: "-fsanitize=address,undefined"
  CXXFLAGS_ASAN: "-fsanitize=address,undefined"

headers:           # required, header file name, do not include path
  - "hdf5.h"
  - "H5public.h"

source_dirs:       # required，folder or files
  - "src/"
  - "hl/src/"

exclude_dirs:      # optional
  - "test/"
  - "testpar/"
  - "tools/"
  - "utils/"
  - "fortran/"
  - "java/"
  - "c++/"

static_build:      # required
  static_lib_name: "libhdf5.a"
  output: "build/{static_lib_name}"
  command: |
    rm -rf hdf5 && \
    git clone {repo_url} hdf5 && \
    cd hdf5 && \
    mkdir -p build && cd build && \
    CC={CC_FUZZ} cmake .. \
      -DBUILD_SHARED_LIBS=OFF \
      -DHDF5_BUILD_EXAMPLES=OFF \
      -DBUILD_TESTING=OFF \
      -DHDF5_BUILD_TOOLS=OFF \
      -DHDF5_BUILD_UTILS=OFF \
      -DHDF5_BUILD_FORTRAN=OFF \
      -DHDF5_BUILD_CPP_LIB=OFF \
      -DHDF5_BUILD_JAVA=OFF \
      -DHDF5_ENABLE_PARALLEL=OFF && \
    make -j$(nproc)

shared_build:     # optional
  shared_lib_name: "libhdf5.so"
  output: "build/{shared_lib_name}"
  command: |
    rm -rf hdf5 && \
    git clone {repo_url} hdf5 && \
    cd hdf5 && \
    mkdir -p build && cd build && \
    CC={CC_FUZZ} cmake .. \
      -DBUILD_SHARED_LIBS=ON \
      -DHDF5_BUILD_EXAMPLES=OFF \
      -DBUILD_TESTING=OFF \
      -DHDF5_BUILD_TOOLS=OFF \
      -DHDF5_BUILD_UTILS=OFF \
      -DHDF5_BUILD_FORTRAN=OFF \
      -DHDF5_BUILD_CPP_LIB=OFF \
      -DHDF5_BUILD_JAVA=OFF \
      -DHDF5_ENABLE_PARALLEL=OFF && \
    make -j$(nproc)

# driver_build: 配置harness编译参数
# 用于指定编译API harness时需要的编译器、依赖库和特殊标志
# config_parser.py会读取这些配置并动态构建完整的编译命令
driver_build:
  compiler:             # 编译器配置 (通常使用AFL++的插桩编译器)
    - "{CC_FUZZ}"        # 示例: afl-clang-fast, afl-gcc
  extra_flags:          # 库特定的编译标志 (预处理器定义、优化选项等)
    - "-lz"              # HDF5 requires zlib
    - "-lm"              # Math library

api_selection:
  api_prefix:      # required - HDF5 API functions typically start with H5
    - "H5"
  api_macros:           # required - Look for HDF5 API patterns
    - "H5_DLL"         # HDF5 public API marker
    - "HDFAPI"         # Alternative API marker
    - "H5TOOLS_DLL"    # Tools API marker
  exclude:            # optional - Exclude internal/private functions
    - ""            # Private functions usually start with H5_

documentation:       # optional
  target_files:      # optional, specific documentation files to analyze
    - "README.md"
    - "INSTALL"
    - "release_docs/INSTALL"

# fuzzing configuration
fuzzing:
  seeds_dir: "/home/kansx/SVF-Tools/Slicer/tools/driver/configs/hdf5/seeds"  # required, absolute path to seeds directory
  dictionary_file: "/home/kansx/SVF-Tools/Slicer/tools/driver/configs/hdf5/hdf5.dict"  # optional, absolute path to dictionary file
